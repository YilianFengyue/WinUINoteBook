<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="App2.Pages.DrawingPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 画板工具栏 -->
        <CommandBar Grid.Row="0" DefaultLabelPosition="Right">
            <!-- 画笔工具 -->
            <AppBarToggleButton x:Name="BrushTool" 
                              ToolTipService.ToolTip="画笔" 
                              IsChecked="True"
                              Click="BrushTool_Click">
                <AppBarToggleButton.Icon>
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xED63;"/>
                </AppBarToggleButton.Icon>
            </AppBarToggleButton>

            <!-- 橡皮擦工具 -->
            <AppBarToggleButton x:Name="EraserTool" 
                              ToolTipService.ToolTip="橡皮擦"
                              Click="EraserTool_Click">
                <AppBarToggleButton.Icon>
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE75C;"/>
                </AppBarToggleButton.Icon>
            </AppBarToggleButton>

            <AppBarSeparator/>

            <!-- 颜色选择 -->
            <AppBarButton x:Name="ColorPicker" 
                         ToolTipService.ToolTip="选择颜色"
                         Click="ColorPicker_Click">
                <AppBarButton.Icon>
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE790;"/>
                </AppBarButton.Icon>
            </AppBarButton>

            <!-- 笔刷大小 -->
            <AppBarButton ToolTipService.ToolTip="笔刷大小">
                <AppBarButton.Icon>
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE91B;"/>
                </AppBarButton.Icon>
                <AppBarButton.Flyout>
                    <Flyout>
                        <StackPanel Width="200">
                            <TextBlock Text="笔刷大小" FontWeight="SemiBold" Margin="0,0,0,10"/>
                            <Slider x:Name="BrushSizeSlider" 
                                   Minimum="1" Maximum="50" Value="5"
                                   ValueChanged="BrushSizeSlider_ValueChanged"/>
                            <TextBlock Text="{x:Bind BrushSizeSlider.Value, Mode=OneWay}" 
                                      HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Flyout>
                </AppBarButton.Flyout>
            </AppBarButton>

            <AppBarSeparator/>

            <!-- 清除画布 -->
            <AppBarButton ToolTipService.ToolTip="清除画布" 
                         Click="ClearCanvas_Click">
                <AppBarButton.Icon>
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE74D;"/>
                </AppBarButton.Icon>
            </AppBarButton>

            <!-- 撤销 -->
            <AppBarButton x:Name="UndoButton" 
                         ToolTipService.ToolTip="撤销" 
                         Click="Undo_Click"
                         IsEnabled="False">
                <AppBarButton.Icon>
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE7A7;"/>
                </AppBarButton.Icon>
            </AppBarButton>

            <!-- 重做 -->
            <AppBarButton x:Name="RedoButton" 
                         ToolTipService.ToolTip="重做" 
                         Click="Redo_Click"
                         IsEnabled="False">
                <AppBarButton.Icon>
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE7A6;"/>
                </AppBarButton.Icon>
            </AppBarButton>
        </CommandBar>

        <!-- 画布区域 -->
        <Grid Grid.Row="1" Margin="20">
            <Border Background="White"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="2"
                    CornerRadius="8">

                <!-- 实际的绘图画布 -->
                <Canvas x:Name="DrawingCanvas"
                       Background="Transparent"
                       PointerPressed="DrawingCanvas_PointerPressed"
                       PointerMoved="DrawingCanvas_PointerMoved"
                       PointerReleased="DrawingCanvas_PointerReleased"
                       PointerExited="DrawingCanvas_PointerExited"/>
            </Border>

            <!-- 状态栏 -->
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                   BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                   BorderThickness="1"
                   CornerRadius="4"
                   Padding="12,6"
                   HorizontalAlignment="Left"
                   VerticalAlignment="Bottom"
                   Margin="8">
                <StackPanel Orientation="Horizontal" Spacing="16">
                    <TextBlock x:Name="StatusText" 
                              Text="画笔工具 | 大小: 5 | 颜色: 黑色"
                              FontSize="12"
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- 颜色选择器弹出窗口 -->
        <Popup x:Name="ColorPickerPopup" 
               IsLightDismissEnabled="True">
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                   BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                   BorderThickness="1"
                   CornerRadius="8"
                   Padding="16">
                <StackPanel Width="200">
                    <TextBlock Text="选择颜色" FontWeight="SemiBold" Margin="0,0,0,12"/>

                    <!-- 预设颜色网格 -->
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- 第一行颜色 -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
                            <Button Width="30" Height="30" Background="Black" Click="ColorButton_Click" Tag="Black" BorderThickness="1"/>
                            <Button Width="30" Height="30" Background="Red" Click="ColorButton_Click" Tag="Red" BorderThickness="1"/>
                            <Button Width="30" Height="30" Background="Blue" Click="ColorButton_Click" Tag="Blue" BorderThickness="1"/>
                            <Button Width="30" Height="30" Background="Green" Click="ColorButton_Click" Tag="Green" BorderThickness="1"/>
                            <Button Width="30" Height="30" Background="Yellow" Click="ColorButton_Click" Tag="Yellow" BorderThickness="1"/>
                            <Button Width="30" Height="30" Background="Orange" Click="ColorButton_Click" Tag="Orange" BorderThickness="1"/>
                        </StackPanel>

                        <!-- 第二行颜色 -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="8">
                            <Button Width="30" Height="30" Background="Purple" Click="ColorButton_Click" Tag="Purple" BorderThickness="1"/>
                            <Button Width="30" Height="30" Background="Pink" Click="ColorButton_Click" Tag="Pink" BorderThickness="1"/>
                            <Button Width="30" Height="30" Background="Brown" Click="ColorButton_Click" Tag="Brown" BorderThickness="1"/>
                            <Button Width="30" Height="30" Background="Gray" Click="ColorButton_Click" Tag="Gray" BorderThickness="1"/>
                            <Button Width="30" Height="30" Background="LightBlue" Click="ColorButton_Click" Tag="LightBlue" BorderThickness="1"/>
                            <Button Width="30" Height="30" Background="LightGreen" Click="ColorButton_Click" Tag="LightGreen" BorderThickness="1"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>
        </Popup>
    </Grid>
</Page>